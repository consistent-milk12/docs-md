# Crate `backtrace`

A library for acquiring a backtrace at runtime

This library is meant to supplement the `RUST_BACKTRACE=1` support of the
standard library by allowing an acquisition of a backtrace at runtime
programmatically. The backtraces generated by this library do not need to be
parsed, for example, and expose the functionality of multiple backend
implementations.

# Usage

First, add this to your Cargo.toml

```toml
[dependencies](#dependencies)

backtrace = "0.3"
```

Next:

```
# // Unsafe here so test passes on no_std.
# #[cfg(feature = "std")] {
backtrace::trace(|frame| {
    let ip = frame.ip();
    let symbol_address = frame.symbol_address();

    // Resolve this instruction pointer to a symbol name
    backtrace::resolve_frame(frame, |symbol| {
        if let Some(name) = symbol.name() {
            // ...
        }
        if let Some(filename) = symbol.filename() {
            // ...
        }
    });

    true // keep going to the next frame
});
# }
```

# Backtrace accuracy

This crate implements best-effort attempts to get the native backtrace. This
is not always guaranteed to work, and some platforms don't return any
backtrace at all. If your application requires accurate backtraces then it's
recommended to closely evaluate this crate to see whether it's suitable
for your use case on your target platforms.

Even on supported platforms, there's a number of reasons that backtraces may
be less-than-accurate, including but not limited to:

* Unwind information may not be available. This crate primarily implements
  backtraces by unwinding the stack, but not all functions may have
  unwinding information (e.g. DWARF unwinding information).

* Rust code may be compiled without unwinding information for some
  functions. This can also happen for Rust code compiled with
  `-Cpanic=abort`. You can remedy this, however, with
  `-Cforce-unwind-tables` as a compiler option.

* Unwind information may be inaccurate or corrupt. In the worst case
  inaccurate unwind information can lead this library to segfault. In the
  best case inaccurate information will result in a truncated stack trace.

* Backtraces may not report filenames/line numbers correctly due to missing
  or corrupt debug information. This won't lead to segfaults unlike corrupt
  unwinding information, but missing or malformed debug information will
  mean that filenames and line numbers will not be available. This may be
  because debug information wasn't generated by the compiler, or it's just
  missing on the filesystem.

* Not all platforms are supported. For example there's no way to get a
  backtrace on WebAssembly at the moment.

* Crate features may be disabled. Currently this crate supports using Gimli
  libbacktrace on non-Windows platforms for reading debuginfo for
  backtraces. If both crate features are disabled, however, then these
  platforms will generate a backtrace but be unable to generate symbols for
  it.

In most standard workflows for most standard platforms you generally don't
need to worry about these caveats. We'll try to fix ones where we can over
time, but otherwise it's important to be aware of the limitations of
unwinding-based backtraces!

## Structs

### `Frame`

```rust
struct Frame {
    // [REDACTED: Private Fields]
}
```

A trait representing one frame of a backtrace, yielded to the `trace`
function of this crate.

The tracing function's closure will be yielded frames, and the frame is
virtually dispatched as the underlying implementation is not always known
until runtime.

#### Implementations

- `fn ip(self: &Self) -> *mut c_void`
  Returns the current instruction pointer of this frame.

- `fn sp(self: &Self) -> *mut c_void`
  Returns the current stack pointer of this frame.

- `fn symbol_address(self: &Self) -> *mut c_void`
  Returns the starting symbol address of the frame of this function.

- `fn module_base_address(self: &Self) -> Option<*mut c_void>`
  Returns the base address of the module to which the frame belongs.

#### Trait Implementations

##### `impl From<T>`

- `fn from(t: T) -> T`
  Returns the argument unchanged.

##### `impl Into<T, U>`

- `fn into(self: Self) -> U`
  Calls `U::from(self)`.

##### `impl Any<T>`

- `fn type_id(self: &Self) -> TypeId`

##### `impl Borrow<T>`

- `fn borrow(self: &Self) -> &T`

##### `impl BorrowMut<T>`

- `fn borrow_mut(self: &mut Self) -> &mut T`

##### `impl Clone`

- `fn clone(self: &Self) -> Frame`

##### `impl CloneToUninit<T>`

- `unsafe fn clone_to_uninit(self: &Self, dest: *mut u8)`

##### `impl ToOwned<T>`

- `type Owned = T`

- `fn to_owned(self: &Self) -> T`

- `fn clone_into(self: &Self, target: &mut T)`

##### `impl TryFrom<T, U>`

- `type Error = Infallible`

- `fn try_from(value: U) -> Result<T, <T as TryFrom>::Error>`

##### `impl TryInto<T, U>`

- `type Error = <U as TryFrom>::Error`

- `fn try_into(self: Self) -> Result<U, <U as TryFrom>::Error>`

##### `impl Debug`

- `fn fmt(self: &Self, f: &mut fmt::Formatter<'_>) -> fmt::Result`

### `Symbol`

```rust
struct Symbol {
    // [REDACTED: Private Fields]
}
```

A trait representing the resolution of a symbol in a file.

This trait is yielded as a trait object to the closure given to the
`backtrace::resolve` function, and it is virtually dispatched as it's
unknown which implementation is behind it.

A symbol can give contextual information about a function, for example the
name, filename, line number, precise address, etc. Not all information is
always available in a symbol, however, so all methods return an `Option`.

#### Implementations

- `fn name(self: &Self) -> Option<SymbolName<'_>>`
  Returns the name of this function.

- `fn addr(self: &Self) -> Option<*mut c_void>`
  Returns the starting address of this function.

- `fn filename_raw(self: &Self) -> Option<BytesOrWideString<'_>>`
  Returns the raw filename as a slice. This is mainly useful for `no_std`

- `fn colno(self: &Self) -> Option<u32>`
  Returns the column number for where this symbol is currently executing.

- `fn lineno(self: &Self) -> Option<u32>`
  Returns the line number for where this symbol is currently executing.

- `fn filename(self: &Self) -> Option<&Path>`
  Returns the file name where this function was defined.

#### Trait Implementations

##### `impl From<T>`

- `fn from(t: T) -> T`
  Returns the argument unchanged.

##### `impl Into<T, U>`

- `fn into(self: Self) -> U`
  Calls `U::from(self)`.

##### `impl Any<T>`

- `fn type_id(self: &Self) -> TypeId`

##### `impl Borrow<T>`

- `fn borrow(self: &Self) -> &T`

##### `impl BorrowMut<T>`

- `fn borrow_mut(self: &mut Self) -> &mut T`

##### `impl TryFrom<T, U>`

- `type Error = Infallible`

- `fn try_from(value: U) -> Result<T, <T as TryFrom>::Error>`

##### `impl TryInto<T, U>`

- `type Error = <U as TryFrom>::Error`

- `fn try_into(self: Self) -> Result<U, <U as TryFrom>::Error>`

##### `impl Debug`

- `fn fmt(self: &Self, f: &mut fmt::Formatter<'_>) -> fmt::Result`

### `SymbolName<'a>`

```rust
struct SymbolName<'a> {
    // [REDACTED: Private Fields]
}
```

A wrapper around a symbol name to provide ergonomic accessors to the
demangled name, the raw bytes, the raw string, etc.

#### Implementations

- `fn new(bytes: &'a [u8]) -> SymbolName<'a>`
  Creates a new symbol name from the raw underlying bytes.

- `fn as_str(self: &Self) -> Option<&'a str>`
  Returns the raw (mangled) symbol name as a `str` if the symbol is valid utf-8.

- `fn as_bytes(self: &Self) -> &'a [u8]`
  Returns the raw symbol name as a list of bytes

#### Trait Implementations

##### `impl From<T>`

- `fn from(t: T) -> T`
  Returns the argument unchanged.

##### `impl Into<T, U>`

- `fn into(self: Self) -> U`
  Calls `U::from(self)`.

##### `impl Any<T>`

- `fn type_id(self: &Self) -> TypeId`

##### `impl Borrow<T>`

- `fn borrow(self: &Self) -> &T`

##### `impl BorrowMut<T>`

- `fn borrow_mut(self: &mut Self) -> &mut T`

##### `impl Display<'a>`

- `fn fmt(self: &Self, f: &mut fmt::Formatter<'_>) -> fmt::Result`

##### `impl ToString<T>`

- `fn to_string(self: &Self) -> String`

##### `impl TryFrom<T, U>`

- `type Error = Infallible`

- `fn try_from(value: U) -> Result<T, <T as TryFrom>::Error>`

##### `impl TryInto<T, U>`

- `type Error = <U as TryFrom>::Error`

- `fn try_into(self: Self) -> Result<U, <U as TryFrom>::Error>`

##### `impl Debug<'a>`

- `fn fmt(self: &Self, f: &mut fmt::Formatter<'_>) -> fmt::Result`

### `BacktraceFmt<'a, 'b>`

```rust
struct BacktraceFmt<'a, 'b> {
    // [REDACTED: Private Fields]
}
```

A formatter for backtraces.

This type can be used to print a backtrace regardless of where the backtrace
itself comes from. If you have a `Backtrace` type then its `Debug`
implementation already uses this printing format.

#### Implementations

- `fn new(fmt: &'a mut fmt::Formatter<'b>, format: PrintFmt, print_path: &'a mut dyn FnMut(&mut fmt::Formatter<'_>, BytesOrWideString<'_>) -> fmt::Result) -> Self`
  Create a new `BacktraceFmt` which will write output to the provided

- `fn add_context(self: &mut Self) -> fmt::Result`
  Prints a preamble for the backtrace about to be printed.

- `fn frame(self: &mut Self) -> BacktraceFrameFmt<'_, 'a, 'b>`
  Adds a frame to the backtrace output.

- `fn finish(self: &mut Self) -> fmt::Result`
  Completes the backtrace output.

- `fn message(self: &mut Self, msg: &str) -> fmt::Result`
  Inserts a message in the backtrace output.

- `fn formatter(self: &mut Self) -> &mut fmt::Formatter<'b>`
  Return the inner formatter.

#### Trait Implementations

##### `impl From<T>`

- `fn from(t: T) -> T`
  Returns the argument unchanged.

##### `impl Into<T, U>`

- `fn into(self: Self) -> U`
  Calls `U::from(self)`.

##### `impl Any<T>`

- `fn type_id(self: &Self) -> TypeId`

##### `impl Borrow<T>`

- `fn borrow(self: &Self) -> &T`

##### `impl BorrowMut<T>`

- `fn borrow_mut(self: &mut Self) -> &mut T`

##### `impl TryFrom<T, U>`

- `type Error = Infallible`

- `fn try_from(value: U) -> Result<T, <T as TryFrom>::Error>`

##### `impl TryInto<T, U>`

- `type Error = <U as TryFrom>::Error`

- `fn try_into(self: Self) -> Result<U, <U as TryFrom>::Error>`

### `BacktraceFrameFmt<'fmt, 'a, 'b>`

```rust
struct BacktraceFrameFmt<'fmt, 'a, 'b> {
    // [REDACTED: Private Fields]
}
```

A formatter for just one frame of a backtrace.

This type is created by the `BacktraceFmt::frame` function.

#### Implementations

- `fn backtrace_frame(self: &mut Self, frame: &BacktraceFrame) -> fmt::Result`
  Prints a `BacktraceFrame` with this frame formatter.

- `fn backtrace_symbol(self: &mut Self, frame: &BacktraceFrame, symbol: &BacktraceSymbol) -> fmt::Result`
  Prints a `BacktraceSymbol` within a `BacktraceFrame`.

- `fn symbol(self: &mut Self, frame: &Frame, symbol: &super::Symbol) -> fmt::Result`
  Prints a raw traced `Frame` and `Symbol`, typically from within the raw

- `fn print_raw(self: &mut Self, frame_ip: *mut c_void, symbol_name: Option<SymbolName<'_>>, filename: Option<BytesOrWideString<'_>>, lineno: Option<u32>) -> fmt::Result`
  Adds a raw frame to the backtrace output.

- `fn print_raw_with_column(self: &mut Self, frame_ip: *mut c_void, symbol_name: Option<SymbolName<'_>>, filename: Option<BytesOrWideString<'_>>, lineno: Option<u32>, colno: Option<u32>) -> fmt::Result`
  Adds a raw frame to the backtrace output, including column information.

#### Trait Implementations

##### `impl From<T>`

- `fn from(t: T) -> T`
  Returns the argument unchanged.

##### `impl Into<T, U>`

- `fn into(self: Self) -> U`
  Calls `U::from(self)`.

##### `impl Any<T>`

- `fn type_id(self: &Self) -> TypeId`

##### `impl Borrow<T>`

- `fn borrow(self: &Self) -> &T`

##### `impl BorrowMut<T>`

- `fn borrow_mut(self: &mut Self) -> &mut T`

##### `impl Drop`

- `fn drop(self: &mut Self)`

##### `impl TryFrom<T, U>`

- `type Error = Infallible`

- `fn try_from(value: U) -> Result<T, <T as TryFrom>::Error>`

##### `impl TryInto<T, U>`

- `type Error = <U as TryFrom>::Error`

- `fn try_into(self: Self) -> Result<U, <U as TryFrom>::Error>`

### `Backtrace`

```rust
struct Backtrace {
    // [REDACTED: Private Fields]
}
```

Representation of an owned and self-contained backtrace.

This structure can be used to capture a backtrace at various points in a
program and later used to inspect what the backtrace was at that time.

`Backtrace` supports pretty-printing of backtraces through its `Debug`
implementation.

# Required features

This function requires the `std` feature of the `backtrace` crate to be
enabled, and the `std` feature is enabled by default.

#### Implementations

- `fn new() -> Backtrace`
  Captures a backtrace at the callsite of this function, returning an

- `fn new_unresolved() -> Backtrace`
  Similar to `new` except that this does not resolve any symbols, this

- `fn frames(self: &Self) -> &[BacktraceFrame]`
  Returns the frames from when this backtrace was captured.

- `fn resolve(self: &mut Self)`
  If this backtrace was created from `new_unresolved` then this function

#### Trait Implementations

##### `impl From`

- `fn from(frames: Vec<BacktraceFrame>) -> Self`

##### `impl From<T>`

- `fn from(t: T) -> T`
  Returns the argument unchanged.

##### `impl Into<T, U>`

- `fn into(self: Self) -> U`
  Calls `U::from(self)`.

##### `impl Into`

- `fn into(self: Self) -> Vec<BacktraceFrame>`

##### `impl Any<T>`

- `fn type_id(self: &Self) -> TypeId`

##### `impl Borrow<T>`

- `fn borrow(self: &Self) -> &T`

##### `impl BorrowMut<T>`

- `fn borrow_mut(self: &mut Self) -> &mut T`

##### `impl Clone`

- `fn clone(self: &Self) -> Backtrace`

##### `impl CloneToUninit<T>`

- `unsafe fn clone_to_uninit(self: &Self, dest: *mut u8)`

##### `impl ToOwned<T>`

- `type Owned = T`

- `fn to_owned(self: &Self) -> T`

- `fn clone_into(self: &Self, target: &mut T)`

##### `impl TryFrom<T, U>`

- `type Error = Infallible`

- `fn try_from(value: U) -> Result<T, <T as TryFrom>::Error>`

##### `impl TryInto<T, U>`

- `type Error = <U as TryFrom>::Error`

- `fn try_into(self: Self) -> Result<U, <U as TryFrom>::Error>`

##### `impl Debug`

- `fn fmt(self: &Self, fmt: &mut fmt::Formatter<'_>) -> fmt::Result`

##### `impl Default`

- `fn default() -> Backtrace`

### `BacktraceFrame`

```rust
struct BacktraceFrame {
    // [REDACTED: Private Fields]
}
```

Captured version of a frame in a backtrace.

This type is returned as a list from `Backtrace::frames` and represents one
stack frame in a captured backtrace.

# Required features

This function requires the `std` feature of the `backtrace` crate to be
enabled, and the `std` feature is enabled by default.

#### Implementations

- `fn ip(self: &Self) -> *mut c_void`
  Same as `Frame::ip`

- `fn symbol_address(self: &Self) -> *mut c_void`
  Same as `Frame::symbol_address`

- `fn module_base_address(self: &Self) -> Option<*mut c_void>`
  Same as `Frame::module_base_address`

- `fn symbols(self: &Self) -> &[BacktraceSymbol]`
  Returns the list of symbols that this frame corresponds to.

- `fn resolve(self: &mut Self)`
  Resolve all addresses in this frame to their symbolic names.

#### Trait Implementations

##### `impl From<T>`

- `fn from(t: T) -> T`
  Returns the argument unchanged.

##### `impl From`

- `fn from(frame: crate::Frame) -> Self`

##### `impl Into<T, U>`

- `fn into(self: Self) -> U`
  Calls `U::from(self)`.

##### `impl Any<T>`

- `fn type_id(self: &Self) -> TypeId`

##### `impl Borrow<T>`

- `fn borrow(self: &Self) -> &T`

##### `impl BorrowMut<T>`

- `fn borrow_mut(self: &mut Self) -> &mut T`

##### `impl Clone`

- `fn clone(self: &Self) -> BacktraceFrame`

##### `impl CloneToUninit<T>`

- `unsafe fn clone_to_uninit(self: &Self, dest: *mut u8)`

##### `impl ToOwned<T>`

- `type Owned = T`

- `fn to_owned(self: &Self) -> T`

- `fn clone_into(self: &Self, target: &mut T)`

##### `impl TryFrom<T, U>`

- `type Error = Infallible`

- `fn try_from(value: U) -> Result<T, <T as TryFrom>::Error>`

##### `impl TryInto<T, U>`

- `type Error = <U as TryFrom>::Error`

- `fn try_into(self: Self) -> Result<U, <U as TryFrom>::Error>`

##### `impl Debug`

- `fn fmt(self: &Self, fmt: &mut fmt::Formatter<'_>) -> fmt::Result`

### `BacktraceSymbol`

```rust
struct BacktraceSymbol {
    // [REDACTED: Private Fields]
}
```

Captured version of a symbol in a backtrace.

This type is returned as a list from `BacktraceFrame::symbols` and
represents the metadata for a symbol in a backtrace.

# Required features

This function requires the `std` feature of the `backtrace` crate to be
enabled, and the `std` feature is enabled by default.

#### Implementations

- `fn name(self: &Self) -> Option<SymbolName<'_>>`
  Same as `Symbol::name`

- `fn addr(self: &Self) -> Option<*mut c_void>`
  Same as `Symbol::addr`

- `fn filename(self: &Self) -> Option<&Path>`
  Same as `Symbol::filename`

- `fn lineno(self: &Self) -> Option<u32>`
  Same as `Symbol::lineno`

- `fn colno(self: &Self) -> Option<u32>`
  Same as `Symbol::colno`

#### Trait Implementations

##### `impl From<T>`

- `fn from(t: T) -> T`
  Returns the argument unchanged.

##### `impl Into<T, U>`

- `fn into(self: Self) -> U`
  Calls `U::from(self)`.

##### `impl Any<T>`

- `fn type_id(self: &Self) -> TypeId`

##### `impl Borrow<T>`

- `fn borrow(self: &Self) -> &T`

##### `impl BorrowMut<T>`

- `fn borrow_mut(self: &mut Self) -> &mut T`

##### `impl Clone`

- `fn clone(self: &Self) -> BacktraceSymbol`

##### `impl CloneToUninit<T>`

- `unsafe fn clone_to_uninit(self: &Self, dest: *mut u8)`

##### `impl ToOwned<T>`

- `type Owned = T`

- `fn to_owned(self: &Self) -> T`

- `fn clone_into(self: &Self, target: &mut T)`

##### `impl TryFrom<T, U>`

- `type Error = Infallible`

- `fn try_from(value: U) -> Result<T, <T as TryFrom>::Error>`

##### `impl TryInto<T, U>`

- `type Error = <U as TryFrom>::Error`

- `fn try_into(self: Self) -> Result<U, <U as TryFrom>::Error>`

##### `impl Debug`

- `fn fmt(self: &Self, fmt: &mut fmt::Formatter<'_>) -> fmt::Result`

## Enums

### `BytesOrWideString<'a>`

```rust
enum BytesOrWideString<'a> {
    Bytes(&'a [u8]),
    Wide(&'a [u16]),
}
```

A platform independent representation of a string. When working with `std`
enabled it is recommended to the convenience methods for providing
conversions to `std` types.

#### Variants

- **`Bytes`**

  A slice, typically provided on Unix platforms.

- **`Wide`**

  Wide strings typically from Windows.

#### Implementations

- `fn to_str_lossy(self: &Self) -> Cow<'a, str>`
  Lossy converts to a `Cow<str>`, will allocate if `Bytes` is not valid

- `fn into_path_buf(self: Self) -> PathBuf`
  Provides a `Path` representation of `BytesOrWideString`.

#### Trait Implementations

##### `impl From<T>`

- `fn from(t: T) -> T`
  Returns the argument unchanged.

##### `impl Into<T, U>`

- `fn into(self: Self) -> U`
  Calls `U::from(self)`.

##### `impl Any<T>`

- `fn type_id(self: &Self) -> TypeId`

##### `impl Borrow<T>`

- `fn borrow(self: &Self) -> &T`

##### `impl BorrowMut<T>`

- `fn borrow_mut(self: &mut Self) -> &mut T`

##### `impl Display<'a>`

- `fn fmt(self: &Self, f: &mut fmt::Formatter<'_>) -> fmt::Result`

##### `impl ToString<T>`

- `fn to_string(self: &Self) -> String`

##### `impl TryFrom<T, U>`

- `type Error = Infallible`

- `fn try_from(value: U) -> Result<T, <T as TryFrom>::Error>`

##### `impl TryInto<T, U>`

- `type Error = <U as TryFrom>::Error`

- `fn try_into(self: Self) -> Result<U, <U as TryFrom>::Error>`

##### `impl Debug<'a>`

- `fn fmt(self: &Self, f: &mut $crate::fmt::Formatter<'_>) -> $crate::fmt::Result`

### `PrintFmt`

```rust
enum PrintFmt {
    Short,
    Full,
}
```

The styles of printing that we can print

#### Variants

- **`Short`**

  Prints a terser backtrace which ideally only contains relevant information

- **`Full`**

  Prints a backtrace that contains all possible information

#### Trait Implementations

##### `impl From<T>`

- `fn from(t: T) -> T`
  Returns the argument unchanged.

##### `impl Into<T, U>`

- `fn into(self: Self) -> U`
  Calls `U::from(self)`.

##### `impl Any<T>`

- `fn type_id(self: &Self) -> TypeId`

##### `impl Borrow<T>`

- `fn borrow(self: &Self) -> &T`

##### `impl BorrowMut<T>`

- `fn borrow_mut(self: &mut Self) -> &mut T`

##### `impl Clone`

- `fn clone(self: &Self) -> PrintFmt`

##### `impl CloneToUninit<T>`

- `unsafe fn clone_to_uninit(self: &Self, dest: *mut u8)`

##### `impl Copy`

##### `impl Eq`

##### `impl PartialEq`

- `fn eq(self: &Self, other: &PrintFmt) -> bool`

##### `impl StructuralPartialEq`

##### `impl ToOwned<T>`

- `type Owned = T`

- `fn to_owned(self: &Self) -> T`

- `fn clone_into(self: &Self, target: &mut T)`

##### `impl TryFrom<T, U>`

- `type Error = Infallible`

- `fn try_from(value: U) -> Result<T, <T as TryFrom>::Error>`

##### `impl TryInto<T, U>`

- `type Error = <U as TryFrom>::Error`

- `fn try_into(self: Self) -> Result<U, <U as TryFrom>::Error>`

## Functions

