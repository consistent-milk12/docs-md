*[tracing_attributes](../index.md) / [expand](index.md)*

---

# Module `expand`

## Contents

- [Structs](#structs)
  - [`AsyncInfo`](#asyncinfo)
  - [`IdentAndTypesRenamer`](#identandtypesrenamer)
  - [`ImplTraitEraser`](#impltraiteraser)
- [Enums](#enums)
  - [`RecordType`](#recordtype)
  - [`AsyncKind`](#asynckind)
- [Functions](#functions)
  - [`gen_function`](#gen_function)
  - [`gen_block`](#gen_block)
  - [`param_names`](#param_names)
  - [`path_to_string`](#path_to_string)
  - [`erase_impl_trait`](#erase_impl_trait)

## Quick Reference

| Item | Kind | Description |
|------|------|-------------|
| [`AsyncInfo`](#asyncinfo) | struct |  |
| [`IdentAndTypesRenamer`](#identandtypesrenamer) | struct | A visitor struct to replace idents and types in some piece |
| [`ImplTraitEraser`](#impltraiteraser) | struct |  |
| [`RecordType`](#recordtype) | enum | Indicates whether a field should be recorded as `Value` or `Debug`. |
| [`AsyncKind`](#asynckind) | enum | The specific async code pattern that was detected |
| [`gen_function`](#gen_function) | fn | Given an existing function, generate an instrumented version of that function |
| [`gen_block`](#gen_block) | fn | Instrument a block |
| [`param_names`](#param_names) | fn |  |
| [`path_to_string`](#path_to_string) | fn |  |
| [`erase_impl_trait`](#erase_impl_trait) | fn |  |

## Structs

### `AsyncInfo<'block>`

```rust
struct AsyncInfo<'block> {
    source_stmt: &'block syn::Stmt,
    kind: AsyncKind<'block>,
    self_type: Option<syn::TypePath>,
    input: &'block syn::ItemFn,
}
```

#### Implementations

- <span id="asyncinfo-from-fn"></span>`fn from_fn(input: &'block ItemFn) -> Option<Self>`

- <span id="asyncinfo-gen-async"></span>`fn gen_async(self, args: InstrumentArgs, instrumented_function_name: &str) -> Result<proc_macro::TokenStream, syn::Error>` â€” [`InstrumentArgs`](../attr/index.md)

### `IdentAndTypesRenamer<'a>`

```rust
struct IdentAndTypesRenamer<'a> {
    types: Vec<(&'a str, syn::TypePath)>,
    idents: Vec<(syn::Ident, syn::Ident)>,
}
```

A visitor struct to replace idents and types in some piece
of code (e.g. the "self" and "Self" tokens in user-supplied
fields expressions when the function is generated by an old
version of async-trait).

#### Trait Implementations

##### `impl VisitMut for IdentAndTypesRenamer<'_>`

- <span id="identandtypesrenamer-visit-ident-mut"></span>`fn visit_ident_mut(&mut self, id: &mut Ident)`

- <span id="identandtypesrenamer-visit-type-mut"></span>`fn visit_type_mut(&mut self, ty: &mut Type)`

### `ImplTraitEraser`

```rust
struct ImplTraitEraser;
```

#### Trait Implementations

##### `impl VisitMut for ImplTraitEraser`

- <span id="impltraiteraser-visit-type-mut"></span>`fn visit_type_mut(&mut self, t: &mut Type)`

## Enums

### `RecordType`

```rust
enum RecordType {
    Value,
    Debug,
}
```

Indicates whether a field should be recorded as `Value` or `Debug`.

#### Variants

- **`Value`**

  The field should be recorded using its `Value` implementation.

- **`Debug`**

  The field should be recorded using `tracing::field::debug()`.

#### Implementations

- <span id="recordtype-types-for-value"></span>`const TYPES_FOR_VALUE: &'static [&'static str]`

- <span id="recordtype-parse-from-ty"></span>`fn parse_from_ty(ty: &Type) -> Self`

### `AsyncKind<'a>`

```rust
enum AsyncKind<'a> {
    Function(&'a syn::ItemFn),
    Async {
        async_expr: &'a syn::ExprAsync,
        pinned_box: bool,
    },
}
```

The specific async code pattern that was detected

#### Variants

- **`Function`**

  Immediately-invoked async fn, as generated by `async-trait <= 0.1.43`:
  `async fn foo<...>(...) {...}; Box::pin(foo<...>(...))`

- **`Async`**

  A function returning an async (move) block, optionally `Box::pin`-ed,
  as generated by `async-trait >= 0.1.44`:
  `Box::pin(async move { ... })`

## Functions

### `gen_function`

```rust
fn gen_function<'a, B: ToTokens + 'a>(input: crate::MaybeItemFnRef<'a, B>, args: crate::attr::InstrumentArgs, instrumented_function_name: &str, self_type: Option<&syn::TypePath>) -> proc_macro2::TokenStream
```

Given an existing function, generate an instrumented version of that function

### `gen_block`

```rust
fn gen_block<B: ToTokens>(block: &B, params: &syn::punctuated::Punctuated<syn::FnArg, token::Comma>, async_context: bool, args: crate::attr::InstrumentArgs, instrumented_function_name: &str, self_type: Option<&syn::TypePath>) -> proc_macro2::TokenStream
```

Instrument a block

### `param_names`

```rust
fn param_names(pat: syn::Pat, record_type: RecordType) -> Box<dyn Iterator<Item = (syn::Ident, RecordType)>>
```

### `path_to_string`

```rust
fn path_to_string(path: &syn::Path) -> String
```

### `erase_impl_trait`

```rust
fn erase_impl_trait(ty: &syn::Type) -> syn::Type
```

