*[syn](../index.md) / [spanned](index.md)*

---

# Module `spanned`

A trait that can provide the `Span` of the complete contents of a syntax
tree node.

<br>

# Example

Suppose in a procedural macro we have a [`Type`](../index.md) that we want to assert
implements the `Sync` trait. Maybe this is the type of one of the fields
of a struct for which we are deriving a trait implementation, and we need to
be able to pass a reference to one of those fields across threads.


If the field type does *not* implement `Sync` as required, we want the
compiler to report an error pointing out exactly which type it was.

The following macro code takes a variable `ty` of type `Type` and produces a
static assertion that `Sync` is implemented for that type.

```rust
extern crate proc_macro;

use proc_macro::TokenStream;
use proc_macro2::Span;
use quote::quote_spanned;
use syn::Type;
use syn::spanned::Spanned;

const IGNORE_TOKENS: &str = stringify! {
#[proc_macro_derive(MyMacro)]
};
pub fn my_macro(input: TokenStream) -> TokenStream {
    let ty = get_a_type();
    /* ... */

    let assert_sync = quote_spanned! {ty.span()=>
        struct _AssertSync where #ty: Sync;
    };

    /* ... */
    input
}

fn get_a_type() -> Type {
    unimplemented!()
}
```

By inserting this `assert_sync` fragment into the output code generated by
our macro, the user's code will fail to compile if `ty` does not implement
`Sync`. The errors they would see look like the following.

```text
error[E0277]: the trait bound `*const i32: std::marker::Sync` is not satisfied
  --> src/main.rs:10:21
   |
10 |     bad_field: *const i32,
   |                ^^^^^^^^^^ `*const i32` cannot be shared between threads safely
```

In this technique, using the `Type`'s span for the error message makes the
error appear in the correct place underlining the right type.

<br>

# Limitations

The underlying `proc_macro::Span::join` method is nightly-only. When
called from within a procedural macro in a nightly compiler, `Spanned` will
use `join` to produce the intended span. When not using a nightly compiler,
only the span of the *first token* of the syntax tree node is returned.

In the common case of wanting to use the joined span as the span of a
`syn::Error`, consider instead using `syn::Error::new_spanned` which is
able to span the error correctly under the complete syntax tree node without
needing the unstable `join`.


## Quick Reference

| Item | Kind | Description |
|------|------|-------------|
| [`private`](#private) | mod |  |
| [`Spanned`](#spanned) | trait | A trait that can provide the `Span` of the complete contents of a syntax |

## Modules

- [`private`](private/index.md)

## Traits

### `Spanned`

```rust
trait Spanned: private::Sealed { ... }
```

A trait that can provide the `Span` of the complete contents of a syntax
tree node.

This trait is automatically implemented for all types that implement
[`ToTokens`](#totokens) from the `quote` crate, as well as for `Span` itself.

See the [module documentation] for an example.


#### Required Methods

- `fn span(&self) -> Span`

  Returns a `Span` covering the complete contents of this syntax tree

#### Implementors

- [`Abi`](../index.md)
- [`Abstract`](../token/index.md)
- [`AndAnd`](../token/index.md)
- [`AndEq`](../token/index.md)
- [`And`](../token/index.md)
- [`AngleBracketedGenericArguments`](../index.md)
- [`Arm`](../index.md)
- [`As`](../token/index.md)
- [`AssocConst`](../index.md)
- [`AssocType`](../index.md)
- [`Async`](../token/index.md)
- [`At`](../token/index.md)
- [`Attribute`](../index.md)
- [`Auto`](../token/index.md)
- [`Await`](../token/index.md)
- [`BareFnArg`](../index.md)
- [`BareVariadic`](../index.md)
- [`Become`](../token/index.md)
- [`BinOp`](../index.md)
- [`Block`](../index.md)
- [`BoundLifetimes`](../index.md)
- [`Box`](../token/index.md)
- [`Break`](../token/index.md)
- [`CapturedParam`](../index.md)
- [`CaretEq`](../token/index.md)
- [`Caret`](../token/index.md)
- [`Colon`](../token/index.md)
- [`Comma`](../token/index.md)
- [`ConstParam`](../index.md)
- [`Const`](../token/index.md)
- [`Constraint`](../index.md)
- [`Continue`](../token/index.md)
- [`Crate`](../token/index.md)
- [`Default`](../token/index.md)
- [`DeriveInput`](../index.md)
- [`Do`](../token/index.md)
- [`Dollar`](../token/index.md)
- [`DotDotDot`](../token/index.md)
- [`DotDotEq`](../token/index.md)
- [`DotDot`](../token/index.md)
- [`Dot`](../token/index.md)
- [`Dyn`](../token/index.md)
- [`Else`](../token/index.md)
- [`Enum`](../token/index.md)
- [`EqEq`](../token/index.md)
- [`Eq`](../token/index.md)
- [`ExprArray`](../index.md)
- [`ExprAssign`](../index.md)
- [`ExprAsync`](../index.md)
- [`ExprAwait`](../index.md)
- [`ExprBinary`](../index.md)
- [`ExprBlock`](../index.md)
- [`ExprBreak`](../index.md)
- [`ExprCall`](../index.md)
- [`ExprCast`](../index.md)
- [`ExprClosure`](../index.md)
- [`ExprContinue`](../index.md)
- [`ExprField`](../index.md)
- [`ExprForLoop`](../index.md)
- [`ExprGroup`](../index.md)
- [`ExprIf`](../index.md)
- [`ExprIndex`](../index.md)
- [`ExprInfer`](../index.md)
- [`ExprLet`](../index.md)
- [`ExprLoop`](../index.md)
- [`ExprMatch`](../index.md)
- [`ExprMethodCall`](../index.md)
- [`ExprParen`](../index.md)
- [`ExprRawAddr`](../index.md)
- [`ExprReference`](../index.md)
- [`ExprRepeat`](../index.md)
- [`ExprReturn`](../index.md)
- [`ExprStruct`](../index.md)
- [`ExprTryBlock`](../index.md)
- [`ExprTry`](../index.md)
- [`ExprTuple`](../index.md)
- [`ExprUnary`](../index.md)
- [`ExprUnsafe`](../index.md)
- [`ExprWhile`](../index.md)
- [`ExprYield`](../index.md)
- [`Expr`](../index.md)
- [`Extern`](../token/index.md)
- [`FatArrow`](../token/index.md)
- [`FieldPat`](../index.md)
- [`FieldValue`](../index.md)
- [`Field`](../index.md)
- [`FieldsNamed`](../index.md)
- [`FieldsUnnamed`](../index.md)
- [`Fields`](../index.md)
- [`File`](../index.md)
- [`Final`](../token/index.md)
- [`FnArg`](../index.md)
- [`Fn`](../token/index.md)
- [`For`](../token/index.md)
- [`ForeignItemFn`](../index.md)
- [`ForeignItemMacro`](../index.md)
- [`ForeignItemStatic`](../index.md)
- [`ForeignItemType`](../index.md)
- [`ForeignItem`](../index.md)
- [`Ge`](../token/index.md)
- [`GenericArgument`](../index.md)
- [`GenericParam`](../index.md)
- [`Generics`](../index.md)
- [`Gt`](../token/index.md)
- [`If`](../token/index.md)
- [`ImplGenerics`](../index.md)
- [`ImplItemConst`](../index.md)
- [`ImplItemFn`](../index.md)
- [`ImplItemMacro`](../index.md)
- [`ImplItemType`](../index.md)
- [`ImplItem`](../index.md)
- [`Impl`](../token/index.md)
- [`In`](../token/index.md)
- [`Index`](../index.md)
- [`ItemConst`](../index.md)
- [`ItemEnum`](../index.md)
- [`ItemExternCrate`](../index.md)
- [`ItemFn`](../index.md)
- [`ItemForeignMod`](../index.md)
- [`ItemImpl`](../index.md)
- [`ItemMacro`](../index.md)
- [`ItemMod`](../index.md)
- [`ItemStatic`](../index.md)
- [`ItemStruct`](../index.md)
- [`ItemTraitAlias`](../index.md)
- [`ItemTrait`](../index.md)
- [`ItemType`](../index.md)
- [`ItemUnion`](../index.md)
- [`ItemUse`](../index.md)
- [`Item`](../index.md)
- [`LArrow`](../token/index.md)
- [`Label`](../index.md)
- [`Le`](../token/index.md)
- [`Let`](../token/index.md)
- [`LifetimeParam`](../index.md)
- [`Lifetime`](../index.md)
- [`LitBool`](../index.md)
- [`LitByteStr`](../index.md)
- [`LitByte`](../index.md)
- [`LitCStr`](../index.md)
- [`LitChar`](../index.md)
- [`LitFloat`](../index.md)
- [`LitInt`](../index.md)
- [`LitStr`](../index.md)
- [`Lit`](../index.md)
- [`Local`](../index.md)
- [`Loop`](../token/index.md)
- [`Lt`](../token/index.md)
- [`Macro`](../index.md)
- [`Macro`](../token/index.md)
- [`Match`](../token/index.md)
- [`Member`](../index.md)
- [`MetaList`](../index.md)
- [`MetaNameValue`](../index.md)
- [`Meta`](../index.md)
- [`MinusEq`](../token/index.md)
- [`Minus`](../token/index.md)
- [`Mod`](../token/index.md)
- [`Move`](../token/index.md)
- [`Mut`](../token/index.md)
- [`Ne`](../token/index.md)
- [`Not`](../token/index.md)
- [`Nothing`](../parse/index.md)
- [`OrEq`](../token/index.md)
- [`OrOr`](../token/index.md)
- [`Or`](../token/index.md)
- [`Override`](../token/index.md)
- [`Pair`](../punctuated/index.md)
- [`ParenthesizedGenericArguments`](../index.md)
- [`PatConst`](../index.md)
- [`PatIdent`](../index.md)
- [`PatLit`](../index.md)
- [`PatMacro`](../index.md)
- [`PatOr`](../index.md)
- [`PatParen`](../index.md)
- [`PatPath`](../index.md)
- [`PatRange`](../index.md)
- [`PatReference`](../index.md)
- [`PatRest`](../index.md)
- [`PatSlice`](../index.md)
- [`PatStruct`](../index.md)
- [`PatTupleStruct`](../index.md)
- [`PatTuple`](../index.md)
- [`PatType`](../index.md)
- [`PatWild`](../index.md)
- [`Pat`](../index.md)
- [`PathArguments`](../index.md)
- [`PathSegment`](../index.md)
- [`PathSep`](../token/index.md)
- [`Path`](../index.md)
- [`PercentEq`](../token/index.md)
- [`Percent`](../token/index.md)
- [`PlusEq`](../token/index.md)
- [`Plus`](../token/index.md)
- [`PointerMutability`](../index.md)
- [`Pound`](../token/index.md)
- [`PreciseCapture`](../index.md)
- [`PredicateLifetime`](../index.md)
- [`PredicateType`](../index.md)
- [`Priv`](../token/index.md)
- [`Pub`](../token/index.md)
- [`Punctuated`](../punctuated/index.md)
- [`QSelf`](../index.md)
- [`Question`](../token/index.md)
- [`RArrow`](../token/index.md)
- [`RangeLimits`](../index.md)
- [`Raw`](../token/index.md)
- [`Receiver`](../index.md)
- [`Ref`](../token/index.md)
- [`ReturnType`](../index.md)
- [`Return`](../token/index.md)
- [`SelfType`](../token/index.md)
- [`SelfValue`](../token/index.md)
- [`Semi`](../token/index.md)
- [`ShlEq`](../token/index.md)
- [`Shl`](../token/index.md)
- [`ShrEq`](../token/index.md)
- [`Shr`](../token/index.md)
- [`Signature`](../index.md)
- [`SlashEq`](../token/index.md)
- [`Slash`](../token/index.md)
- [`StarEq`](../token/index.md)
- [`Star`](../token/index.md)
- [`StaticMutability`](../index.md)
- [`Static`](../token/index.md)
- [`StmtMacro`](../index.md)
- [`Stmt`](../index.md)
- [`Struct`](../token/index.md)
- [`Super`](../token/index.md)
- [`Tilde`](../token/index.md)
- [`TokensOrDefault`](../print/index.md)
- [`TraitBoundModifier`](../index.md)
- [`TraitBound`](../index.md)
- [`TraitItemConst`](../index.md)
- [`TraitItemFn`](../index.md)
- [`TraitItemMacro`](../index.md)
- [`TraitItemType`](../index.md)
- [`TraitItem`](../index.md)
- [`Trait`](../token/index.md)
- [`Try`](../token/index.md)
- [`Turbofish`](../index.md)
- [`TypeArray`](../index.md)
- [`TypeBareFn`](../index.md)
- [`TypeGenerics`](../index.md)
- [`TypeGroup`](../index.md)
- [`TypeImplTrait`](../index.md)
- [`TypeInfer`](../index.md)
- [`TypeMacro`](../index.md)
- [`TypeNever`](../index.md)
- [`TypeParamBound`](../index.md)
- [`TypeParam`](../index.md)
- [`TypeParen`](../index.md)
- [`TypePath`](../index.md)
- [`TypePtr`](../index.md)
- [`TypeReference`](../index.md)
- [`TypeSlice`](../index.md)
- [`TypeTraitObject`](../index.md)
- [`TypeTuple`](../index.md)
- [`Type`](../index.md)
- [`Type`](../token/index.md)
- [`Typeof`](../token/index.md)
- [`UnOp`](../index.md)
- [`Underscore`](../token/index.md)
- [`Union`](../token/index.md)
- [`Unsafe`](../token/index.md)
- [`Unsized`](../token/index.md)
- [`UseGlob`](../index.md)
- [`UseGroup`](../index.md)
- [`UseName`](../index.md)
- [`UsePath`](../index.md)
- [`UseRename`](../index.md)
- [`UseTree`](../index.md)
- [`Use`](../token/index.md)
- [`Variadic`](../index.md)
- [`Variant`](../index.md)
- [`Virtual`](../token/index.md)
- [`VisRestricted`](../index.md)
- [`Visibility`](../index.md)
- [`WhereClause`](../index.md)
- [`WherePredicate`](../index.md)
- [`Where`](../token/index.md)
- [`While`](../token/index.md)
- [`Yield`](../token/index.md)
- `T`

